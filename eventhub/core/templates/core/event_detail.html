{% extends "core/base.html" %}

{% block content %}
<div class="container mt-4">
  <div class="card shadow-lg">
    {% if event.image %}
      <img src="{{ event.image.url }}"
           class="card-img-top img-fluid mx-auto d-block"
           alt="{{ event.titre }}"
           style="max-height: 350px; width: auto; object-fit: cover;">
    {% endif %}
    <div class="card-body">
      <h2 class="card-title">{{ event.titre }}</h2>
      <p class="card-text">{{ event.description }}</p>

      <ul class="list-group list-group-flush mb-3">
        <li class="list-group-item">📍 Lieu : <strong>{{ event.lieu }}</strong></li>
        <li class="list-group-item">📅 Date : <strong>{{ event.date|date:"d/m/Y H:i" }}</strong></li>
        <li class="list-group-item">👥 Capacité : <strong>{{ event.capacite }}</strong></li>
        <li class="list-group-item">🏷 Catégorie : <span class="badge bg-primary">{{ event.categorie }}</span></li>
        <li class="list-group-item">👤 Organisateur : {{ event.organisateur.username }}</li>
        <li class="list-group-item">
        👥 Inscriptions : <strong>{{ event.inscriptions.count }} / {{ event.capacite }}</strong>
        </li>
      </ul>

      <div class="d-flex gap-2">
        {% if user.is_authenticated %}
          {% if deja_inscrit %}
            <a href="{% url 'event_unregister' event.pk %}" class="btn btn-outline-danger">🚪 Se désinscrire</a>
          {% elif event.inscriptions.count < event.capacite %}
            <a href="{% url 'event_register' event.pk %}" class="btn btn-success">✅ S’inscrire</a>
          {% else %}
            <button class="btn btn-secondary" disabled>Complet ❌</button>
          {% endif %}
        {% endif %}

        {% if user == event.organisateur %}
          <a href="{% url 'event_update' event.pk %}" class="btn btn-warning">✏️ Modifier</a>
          <a href="{% url 'event_delete' event.pk %}" class="btn btn-danger">🗑 Supprimer</a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Section Avis -->
  <div class="mt-5">
    <h4>📝 Avis des participants</h4>

    {% if avis %}
      <div class="list-group">
        {% for a in avis %}
          <div class="list-group-item">
                <strong>{{ a.user.username }}</strong> – ⭐ {{ a.note }}/5
                <p>{{ a.commentaire }}</p>
                {% if a.image %}
                    <img src="{{ a.image.url }}" alt="Avis image" class="img-fluid rounded" style="max-height:150px;">
                {% endif %}
            </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted">Aucun avis pour le moment.</p>
    {% endif %}

    {% if user.is_authenticated %}
      <a href="{% url 'add_review' event.pk %}" class="btn btn-outline-primary mt-3">✍️ Laisser un avis</a>
    {% endif %}
  </div>
</div>
{% endblock %}
